{"ast":null,"code":"// src/services/fileProcessingService.ts\n\nexport class FileProcessingService {\n  constructor() {\n    this.pollTimer = null;\n    this.API_BASE_URL = \"http://0.0.0.0:8080\";\n  }\n  async checkProcessingStatus(fileId) {\n    try {\n      const response = await fetch(`${this.API_BASE_URL}/api/processing/status/${fileId}`, {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\"\n        },\n        mode: \"cors\" // Explicitly set CORS mode\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(errorText || \"Failed to fetch processing status\");\n      }\n      const data = await response.json();\n      console.log(\"Processing status response:\", data); // Debug log\n\n      return {\n        status: data.status,\n        progress: data.progress,\n        result: data.result,\n        error: data.error\n      };\n    } catch (error) {\n      console.error(\"Error checking processing status:\", error);\n      throw error;\n    }\n  }\n  startPolling(fileId, onProgress, onComplete, onError) {\n    console.log(\"Starting polling for fileId:\", fileId); // Debug log\n\n    this.pollTimer = setInterval(async () => {\n      try {\n        const status = await this.checkProcessingStatus(fileId);\n        console.log(\"Polling status:\", status); // Debug log\n\n        onProgress(status);\n        if (status.status === \"completed\") {\n          console.log(\"Processing completed\"); // Debug log\n          this.stopPolling();\n          onComplete(status.result);\n        } else if (status.status === \"failed\") {\n          console.log(\"Processing failed\"); // Debug log\n          this.stopPolling();\n          onError(new Error(status.error || \"Processing failed\"));\n        }\n      } catch (error) {\n        console.error(\"Polling error:\", error); // Debug log\n        if (error instanceof Error) {\n          onError(error);\n        } else {\n          onError(new Error(\"Unknown error during status check\"));\n        }\n      }\n    }, 2000);\n  }\n  stopPolling() {\n    if (this.pollTimer) {\n      clearInterval(this.pollTimer);\n      this.pollTimer = null;\n    }\n  }\n}","map":{"version":3,"names":["FileProcessingService","constructor","pollTimer","API_BASE_URL","checkProcessingStatus","fileId","response","fetch","method","headers","Accept","mode","ok","errorText","text","Error","data","json","console","log","status","progress","result","error","startPolling","onProgress","onComplete","onError","setInterval","stopPolling","clearInterval"],"sources":["/media/tarun/ITB/code/work/thinkelution/Videolution-Analyzer-App/src/Components/Upload/services/fileProcessingService.ts"],"sourcesContent":["// src/services/fileProcessingService.ts\n\nimport { ProcessingStatus, ProcessingStep } from \"../utils /upload.types\";\n\nexport class FileProcessingService {\n  private pollTimer: NodeJS.Timer | null = null;\n  private API_BASE_URL = \"http://0.0.0.0:8080\";\n\n  public async checkProcessingStatus(\n    fileId: string,\n  ): Promise<ProcessingStatus> {\n    try {\n      const response = await fetch(\n        `${this.API_BASE_URL}/api/processing/status/${fileId}`,\n        {\n          method: \"GET\",\n          headers: {\n            Accept: \"application/json\",\n          },\n          mode: \"cors\", // Explicitly set CORS mode\n        },\n      );\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(errorText || \"Failed to fetch processing status\");\n      }\n\n      const data = await response.json();\n      console.log(\"Processing status response:\", data); // Debug log\n\n      return {\n        status: data.status as ProcessingStep,\n        progress: data.progress,\n        result: data.result,\n        error: data.error,\n      };\n    } catch (error) {\n      console.error(\"Error checking processing status:\", error);\n      throw error;\n    }\n  }\n\n  public startPolling(\n    fileId: string,\n    onProgress: (status: ProcessingStatus) => void,\n    onComplete: (result: any) => void,\n    onError: (error: Error) => void,\n  ): void {\n    console.log(\"Starting polling for fileId:\", fileId); // Debug log\n\n    this.pollTimer = setInterval(async () => {\n      try {\n        const status = await this.checkProcessingStatus(fileId);\n        console.log(\"Polling status:\", status); // Debug log\n\n        onProgress(status);\n\n        if (status.status === \"completed\") {\n          console.log(\"Processing completed\"); // Debug log\n          this.stopPolling();\n          onComplete(status.result);\n        } else if (status.status === \"failed\") {\n          console.log(\"Processing failed\"); // Debug log\n          this.stopPolling();\n          onError(new Error(status.error || \"Processing failed\"));\n        }\n      } catch (error) {\n        console.error(\"Polling error:\", error); // Debug log\n        if (error instanceof Error) {\n          onError(error);\n        } else {\n          onError(new Error(\"Unknown error during status check\"));\n        }\n      }\n    }, 2000);\n  }\n\n  public stopPolling(): void {\n    if (this.pollTimer) {\n      clearInterval(this.pollTimer);\n      this.pollTimer = null;\n    }\n  }\n}\n"],"mappings":"AAAA;;AAIA,OAAO,MAAMA,qBAAqB,CAAC;EAAAC,YAAA;IAAA,KACzBC,SAAS,GAAwB,IAAI;IAAA,KACrCC,YAAY,GAAG,qBAAqB;EAAA;EAE5C,MAAaC,qBAAqBA,CAChCC,MAAc,EACa;IAC3B,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAC1B,GAAG,IAAI,CAACJ,YAAY,0BAA0BE,MAAM,EAAE,EACtD;QACEG,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UACPC,MAAM,EAAE;QACV,CAAC;QACDC,IAAI,EAAE,MAAM,CAAE;MAChB,CACF,CAAC;MAED,IAAI,CAACL,QAAQ,CAACM,EAAE,EAAE;QAChB,MAAMC,SAAS,GAAG,MAAMP,QAAQ,CAACQ,IAAI,CAAC,CAAC;QACvC,MAAM,IAAIC,KAAK,CAACF,SAAS,IAAI,mCAAmC,CAAC;MACnE;MAEA,MAAMG,IAAI,GAAG,MAAMV,QAAQ,CAACW,IAAI,CAAC,CAAC;MAClCC,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEH,IAAI,CAAC,CAAC,CAAC;;MAElD,OAAO;QACLI,MAAM,EAAEJ,IAAI,CAACI,MAAwB;QACrCC,QAAQ,EAAEL,IAAI,CAACK,QAAQ;QACvBC,MAAM,EAAEN,IAAI,CAACM,MAAM;QACnBC,KAAK,EAAEP,IAAI,CAACO;MACd,CAAC;IACH,CAAC,CAAC,OAAOA,KAAK,EAAE;MACdL,OAAO,CAACK,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;MACzD,MAAMA,KAAK;IACb;EACF;EAEOC,YAAYA,CACjBnB,MAAc,EACdoB,UAA8C,EAC9CC,UAAiC,EACjCC,OAA+B,EACzB;IACNT,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEd,MAAM,CAAC,CAAC,CAAC;;IAErD,IAAI,CAACH,SAAS,GAAG0B,WAAW,CAAC,YAAY;MACvC,IAAI;QACF,MAAMR,MAAM,GAAG,MAAM,IAAI,CAAChB,qBAAqB,CAACC,MAAM,CAAC;QACvDa,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEC,MAAM,CAAC,CAAC,CAAC;;QAExCK,UAAU,CAACL,MAAM,CAAC;QAElB,IAAIA,MAAM,CAACA,MAAM,KAAK,WAAW,EAAE;UACjCF,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC,CAAC,CAAC;UACrC,IAAI,CAACU,WAAW,CAAC,CAAC;UAClBH,UAAU,CAACN,MAAM,CAACE,MAAM,CAAC;QAC3B,CAAC,MAAM,IAAIF,MAAM,CAACA,MAAM,KAAK,QAAQ,EAAE;UACrCF,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC,CAAC,CAAC;UAClC,IAAI,CAACU,WAAW,CAAC,CAAC;UAClBF,OAAO,CAAC,IAAIZ,KAAK,CAACK,MAAM,CAACG,KAAK,IAAI,mBAAmB,CAAC,CAAC;QACzD;MACF,CAAC,CAAC,OAAOA,KAAK,EAAE;QACdL,OAAO,CAACK,KAAK,CAAC,gBAAgB,EAAEA,KAAK,CAAC,CAAC,CAAC;QACxC,IAAIA,KAAK,YAAYR,KAAK,EAAE;UAC1BY,OAAO,CAACJ,KAAK,CAAC;QAChB,CAAC,MAAM;UACLI,OAAO,CAAC,IAAIZ,KAAK,CAAC,mCAAmC,CAAC,CAAC;QACzD;MACF;IACF,CAAC,EAAE,IAAI,CAAC;EACV;EAEOc,WAAWA,CAAA,EAAS;IACzB,IAAI,IAAI,CAAC3B,SAAS,EAAE;MAClB4B,aAAa,CAAC,IAAI,CAAC5B,SAAS,CAAC;MAC7B,IAAI,CAACA,SAAS,GAAG,IAAI;IACvB;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}