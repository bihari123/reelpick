{"ast":null,"code":"// src/Components/services/fileUploadService.ts\n\nexport class FileUploadService {\n  constructor() {\n    this.config = {\n      chunkSize: 1024 * 1024,\n      // 1MB chunks\n      maxFileSize: 500 * 1024 * 1024,\n      // 500MB\n      allowedTypes: [\".srt\"],\n      baseUrl: \"http://localhost:8080\"\n    };\n  }\n  async makeRequest(url, method, body, headers) {\n    try {\n      const response = await fetch(`${this.config.baseUrl}${url}`, {\n        method,\n        headers: {\n          ...headers\n        },\n        body\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error(`Request failed: ${url}`, error);\n      throw error;\n    }\n  }\n  async initializeUpload(file) {\n    return this.makeRequest(\"/api/upload/initialize\", \"POST\", JSON.stringify({\n      fileName: file.name,\n      fileSize: file.size,\n      totalChunks: Math.ceil(file.size / this.config.chunkSize)\n    }), {\n      \"Content-Type\": \"application/json\"\n    });\n  }\n  async uploadChunk(chunk, chunkIndex, totalChunks, fileId) {\n    const formData = new FormData();\n    formData.append(\"chunk\", chunk);\n    formData.append(\"chunkIndex\", chunkIndex.toString());\n    formData.append(\"totalChunks\", totalChunks.toString());\n    formData.append(\"fileId\", fileId);\n    return this.makeRequest(\"/api/upload/chunk\", \"POST\", formData, {\n      \"X-File-Id\": fileId,\n      \"X-Chunk-Index\": chunkIndex.toString()\n    });\n  }\n  async uploadFile(file, callbacks) {\n    try {\n      // Validate file before starting upload\n      if (file.size > this.config.maxFileSize) {\n        throw new Error(`File size exceeds maximum limit of ${this.config.maxFileSize / (1024 * 1024)}MB`);\n      }\n      const fileExt = file.name.toLowerCase().split(\".\").pop();\n      if (!fileExt || !this.config.allowedTypes.includes(`.${fileExt}`)) {\n        throw new Error(`File type .${fileExt} is not supported. Allowed types: ${this.config.allowedTypes.join(\", \")}`);\n      }\n\n      // Initialize upload\n      const {\n        fileId\n      } = await this.initializeUpload(file);\n      if (!fileId) {\n        throw new Error(\"Failed to initialize upload: missing fileId\");\n      }\n      const totalChunks = Math.ceil(file.size / this.config.chunkSize);\n      let uploadedChunks = 0;\n      callbacks.onStatusChange(\"analyzing\");\n\n      // Upload chunks\n      for (let chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {\n        const start = chunkIndex * this.config.chunkSize;\n        const end = Math.min(start + this.config.chunkSize, file.size);\n        const chunk = file.slice(start, end);\n        const response = await this.uploadChunk(chunk, chunkIndex, totalChunks, fileId);\n        uploadedChunks++;\n        callbacks.onProgress(response.progress);\n        callbacks.onStatusChange(response.status);\n        if (!response.received) {\n          throw new Error(response.message || \"Chunk upload failed\");\n        }\n      }\n      callbacks.onStatusChange(\"done\");\n      callbacks.onSuccess();\n    } catch (error) {\n      console.error(\"Upload failed:\", error);\n      callbacks.onError(error instanceof Error ? error : new Error(String(error)));\n    }\n  }\n}","map":{"version":3,"names":["FileUploadService","constructor","config","chunkSize","maxFileSize","allowedTypes","baseUrl","makeRequest","url","method","body","headers","response","fetch","ok","errorData","json","Error","error","status","console","initializeUpload","file","JSON","stringify","fileName","name","fileSize","size","totalChunks","Math","ceil","uploadChunk","chunk","chunkIndex","fileId","formData","FormData","append","toString","uploadFile","callbacks","fileExt","toLowerCase","split","pop","includes","join","uploadedChunks","onStatusChange","start","end","min","slice","onProgress","progress","received","message","onSuccess","onError","String"],"sources":["/media/tarun/ITB/code/work/thinkelution/Videolution-Analyzer-App/src/Components/Upload/services/fileUploadService.ts"],"sourcesContent":["// src/Components/services/fileUploadService.ts\n\nimport {\n\tUploadProgressCallback,\n\tChunkUploadResponse,\n\tUploadInitializeResponse,\n\tUploadConfig,\n} from \"../utils/upload.types\";\n\nexport class FileUploadService {\n\tprivate config: UploadConfig = {\n\t\tchunkSize: 1024 * 1024, // 1MB chunks\n\t\tmaxFileSize: 500 * 1024 * 1024, // 500MB\n\t\tallowedTypes: [\".srt\"],\n\t\tbaseUrl: \"http://localhost:8080\",\n\t};\n\n\tprivate async makeRequest<T>(\n\t\turl: string,\n\t\tmethod: string,\n\t\tbody?: any,\n\t\theaders?: HeadersInit,\n\t): Promise<T> {\n\t\ttry {\n\t\t\tconst response = await fetch(`${this.config.baseUrl}${url}`, {\n\t\t\t\tmethod,\n\t\t\t\theaders: {\n\t\t\t\t\t...headers,\n\t\t\t\t},\n\t\t\t\tbody,\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconst errorData = await response.json();\n\t\t\t\tthrow new Error(\n\t\t\t\t\terrorData.error || `HTTP error! status: ${response.status}`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn await response.json();\n\t\t} catch (error) {\n\t\t\tconsole.error(`Request failed: ${url}`, error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate async initializeUpload(\n\t\tfile: File,\n\t): Promise<UploadInitializeResponse> {\n\t\treturn this.makeRequest<UploadInitializeResponse>(\n\t\t\t\"/api/upload/initialize\",\n\t\t\t\"POST\",\n\t\t\tJSON.stringify({\n\t\t\t\tfileName: file.name,\n\t\t\t\tfileSize: file.size,\n\t\t\t\ttotalChunks: Math.ceil(file.size / this.config.chunkSize),\n\t\t\t}),\n\t\t\t{\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate async uploadChunk(\n\t\tchunk: Blob,\n\t\tchunkIndex: number,\n\t\ttotalChunks: number,\n\t\tfileId: string,\n\t): Promise<ChunkUploadResponse> {\n\t\tconst formData = new FormData();\n\t\tformData.append(\"chunk\", chunk);\n\t\tformData.append(\"chunkIndex\", chunkIndex.toString());\n\t\tformData.append(\"totalChunks\", totalChunks.toString());\n\t\tformData.append(\"fileId\", fileId);\n\n\t\treturn this.makeRequest<ChunkUploadResponse>(\n\t\t\t\"/api/upload/chunk\",\n\t\t\t\"POST\",\n\t\t\tformData,\n\t\t\t{\n\t\t\t\t\"X-File-Id\": fileId,\n\t\t\t\t\"X-Chunk-Index\": chunkIndex.toString(),\n\t\t\t},\n\t\t);\n\t}\n\n\tpublic async uploadFile(\n\t\tfile: File,\n\t\tcallbacks: UploadProgressCallback,\n\t): Promise<void> {\n\t\ttry {\n\t\t\t// Validate file before starting upload\n\t\t\tif (file.size > this.config.maxFileSize) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`File size exceeds maximum limit of ${this.config.maxFileSize / (1024 * 1024)}MB`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst fileExt = file.name.toLowerCase().split(\".\").pop();\n\t\t\tif (!fileExt || !this.config.allowedTypes.includes(`.${fileExt}`)) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`File type .${fileExt} is not supported. Allowed types: ${this.config.allowedTypes.join(\", \")}`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Initialize upload\n\t\t\tconst { fileId } = await this.initializeUpload(file);\n\t\t\tif (!fileId) {\n\t\t\t\tthrow new Error(\"Failed to initialize upload: missing fileId\");\n\t\t\t}\n\n\t\t\tconst totalChunks = Math.ceil(file.size / this.config.chunkSize);\n\t\t\tlet uploadedChunks = 0;\n\n\t\t\tcallbacks.onStatusChange(\"analyzing\");\n\n\t\t\t// Upload chunks\n\t\t\tfor (let chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {\n\t\t\t\tconst start = chunkIndex * this.config.chunkSize;\n\t\t\t\tconst end = Math.min(start + this.config.chunkSize, file.size);\n\t\t\t\tconst chunk = file.slice(start, end);\n\n\t\t\t\tconst response = await this.uploadChunk(\n\t\t\t\t\tchunk,\n\t\t\t\t\tchunkIndex,\n\t\t\t\t\ttotalChunks,\n\t\t\t\t\tfileId,\n\t\t\t\t);\n\t\t\t\tuploadedChunks++;\n\n\t\t\t\tcallbacks.onProgress(response.progress);\n\t\t\t\tcallbacks.onStatusChange(response.status);\n\n\t\t\t\tif (!response.received) {\n\t\t\t\t\tthrow new Error(response.message || \"Chunk upload failed\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcallbacks.onStatusChange(\"done\");\n\t\t\tcallbacks.onSuccess();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Upload failed:\", error);\n\t\t\tcallbacks.onError(\n\t\t\t\terror instanceof Error ? error : new Error(String(error)),\n\t\t\t);\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}