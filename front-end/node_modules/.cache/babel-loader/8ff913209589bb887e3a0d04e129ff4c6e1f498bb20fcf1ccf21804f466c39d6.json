{"ast":null,"code":"// src/Components/services/fileUploadService.ts\n\nconst CHUNK_SIZE = 1024 * 1024; // 1MB chunks\n\nexport class FileUploadService {\n  async uploadChunk(chunk, chunkIndex, totalChunks, fileId) {\n    const formData = new FormData();\n    formData.append(\"chunk\", chunk);\n    formData.append(\"chunkIndex\", chunkIndex.toString());\n    formData.append(\"totalChunks\", totalChunks.toString());\n    formData.append(\"fileId\", fileId);\n    try {\n      const response = await fetch(\"/api/upload/chunk\", {\n        method: \"POST\",\n        body: formData\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      throw new Error(`Failed to upload chunk ${chunkIndex}`);\n    }\n  }\n  async initializeUpload(file) {\n    try {\n      const response = await fetch(\"/api/upload/initialize\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          fileName: file.name,\n          fileSize: file.size,\n          totalChunks: Math.ceil(file.size / CHUNK_SIZE)\n        })\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to initialize upload\");\n      }\n      return await response.json();\n    } catch (error) {\n      throw new Error(\"Failed to initialize upload\");\n    }\n  }\n  async uploadFile(file, callbacks) {\n    try {\n      const {\n        fileId\n      } = await this.initializeUpload(file);\n      const totalChunks = Math.ceil(file.size / CHUNK_SIZE);\n      let uploadedChunks = 0;\n      callbacks.onStatusChange(\"analyzing\");\n      for (let chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {\n        const start = chunkIndex * CHUNK_SIZE;\n        const end = Math.min(start + CHUNK_SIZE, file.size);\n        const chunk = file.slice(start, end);\n        await this.uploadChunk(chunk, chunkIndex, totalChunks, fileId);\n        uploadedChunks++;\n        const progress = Math.round(uploadedChunks / totalChunks * 100);\n        callbacks.onProgress(progress);\n        if (progress >= 30 && progress < 60) {\n          callbacks.onStatusChange(\"processing\");\n        } else if (progress >= 60 && progress < 100) {\n          callbacks.onStatusChange(\"finalizing\");\n        }\n      }\n      callbacks.onStatusChange(\"done\");\n      callbacks.onSuccess();\n    } catch (error) {\n      callbacks.onError(error);\n    }\n  }\n}","map":{"version":3,"names":["CHUNK_SIZE","FileUploadService","uploadChunk","chunk","chunkIndex","totalChunks","fileId","formData","FormData","append","toString","response","fetch","method","body","ok","Error","status","json","error","initializeUpload","file","headers","JSON","stringify","fileName","name","fileSize","size","Math","ceil","uploadFile","callbacks","uploadedChunks","onStatusChange","start","end","min","slice","progress","round","onProgress","onSuccess","onError"],"sources":["/media/tarun/ITB/code/work/thinkelution/Videolution-Analyzer-App/src/Components/services/fileUploadService.ts"],"sourcesContent":["// src/Components/services/fileUploadService.ts\n\nimport {\n  UploadProgressCallback,\n  ChunkUploadResponse,\n  UploadInitializeResponse,\n} from \"../types/upload.types\";\n\nconst CHUNK_SIZE = 1024 * 1024; // 1MB chunks\n\nexport class FileUploadService {\n  private async uploadChunk(\n    chunk: Blob,\n    chunkIndex: number,\n    totalChunks: number,\n    fileId: string,\n  ): Promise<ChunkUploadResponse> {\n    const formData = new FormData();\n    formData.append(\"chunk\", chunk);\n    formData.append(\"chunkIndex\", chunkIndex.toString());\n    formData.append(\"totalChunks\", totalChunks.toString());\n    formData.append(\"fileId\", fileId);\n\n    try {\n      const response = await fetch(\"/api/upload/chunk\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      return await response.json();\n    } catch (error) {\n      throw new Error(`Failed to upload chunk ${chunkIndex}`);\n    }\n  }\n\n  private async initializeUpload(\n    file: File,\n  ): Promise<UploadInitializeResponse> {\n    try {\n      const response = await fetch(\"/api/upload/initialize\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          fileName: file.name,\n          fileSize: file.size,\n          totalChunks: Math.ceil(file.size / CHUNK_SIZE),\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to initialize upload\");\n      }\n\n      return await response.json();\n    } catch (error) {\n      throw new Error(\"Failed to initialize upload\");\n    }\n  }\n\n  public async uploadFile(\n    file: File,\n    callbacks: UploadProgressCallback,\n  ): Promise<void> {\n    try {\n      const { fileId } = await this.initializeUpload(file);\n      const totalChunks = Math.ceil(file.size / CHUNK_SIZE);\n      let uploadedChunks = 0;\n\n      callbacks.onStatusChange(\"analyzing\");\n\n      for (let chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {\n        const start = chunkIndex * CHUNK_SIZE;\n        const end = Math.min(start + CHUNK_SIZE, file.size);\n        const chunk = file.slice(start, end);\n\n        await this.uploadChunk(chunk, chunkIndex, totalChunks, fileId);\n        uploadedChunks++;\n\n        const progress = Math.round((uploadedChunks / totalChunks) * 100);\n        callbacks.onProgress(progress);\n\n        if (progress >= 30 && progress < 60) {\n          callbacks.onStatusChange(\"processing\");\n        } else if (progress >= 60 && progress < 100) {\n          callbacks.onStatusChange(\"finalizing\");\n        }\n      }\n\n      callbacks.onStatusChange(\"done\");\n      callbacks.onSuccess();\n    } catch (error) {\n      callbacks.onError(error as Error);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}